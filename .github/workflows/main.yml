name: Run My Bot Forever

on:
  workflow_dispatch: # ุชุดุบูู ูุฏูู ูู ุชุจููุจ Actions
  schedule:
    - cron: '0 */6 * * *' # ุชุดุบูู ุชููุงุฆู ูู 6 ุณุงุนุงุช ูุงุญุชูุงุท

permissions:
  actions: write # ุฅุฐู ุฃุณุงุณู ููุชููู ุงูุจูุช ูู ุฅุนุงุฏุฉ ุชุดุบูู ููุณู

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Chrome and Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y tor xvfb libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libxkbcommon0 libxcomposite1 libxdamage1 libxrandr2 libgbm1 libasound2
          pip install undetected_chromedriver selenium requests

      - name: Configure and Start Tor
        run: |
          sudo service tor stop || true
          # ุฅุนุฏุงุฏ ุงููููุฐ 9051 ููุชุญูู ุจุชุฏููุฑ ุงูู IP
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0\nDataDirectory /var/lib/tor" > /etc/tor/torrc'
          sudo service tor start
          echo "โณ Waiting for Tor to establish circuit..."
          sleep 20

      - name: Start Bot
        # ุงูุฌูุณุฉ ุชุณุชูุฑ 350 ุฏูููุฉ ุซู ุชุบูู ููุณูุง ูุชุจุฏุฃ ุฎุทูุฉ ุฅุนุงุฏุฉ ุงูุชุดุบูู
        run: |
          timeout 350m xvfb-run python -u bot_master1.py || echo "โ๏ธ Time limit reached, preparing next run..."

      - name: Self-Restart Workflow
        if: always() # ูุนูู ุญุชู ูู ุชููู ุงูุณูุฑุจุช ุจุณุจุจ ุฎุทุฃ ุฃู ุงูุชูุงุก ุงูููุช
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "๐ Triggering self-restart..."
          # ุงูุชุฃูุฏ ูู ูุทุงุจูุฉ ุงูุงุณู "Run My Bot Forever" ุชูุงูุงู ูุน ุฃูู ุณุทุฑ ูู ุงูููู
          gh workflow run "Run My Bot Forever"
