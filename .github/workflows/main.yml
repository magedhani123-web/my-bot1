name: Run My Bot Forever

on:
  workflow_dispatch: # ููุชุดุบูู ุงููุฏูู
  schedule:
    - cron: '0 */6 * * *' # ุชุดุบูู ุชููุงุฆู ูู 6 ุณุงุนุงุช ูุงุญุชูุงุท

permissions:
  actions: write # ุถุฑูุฑู ููุณูุงุญ ููุณูุฑุจุช ุจุฅุนุงุฏุฉ ุชุดุบูู ููุณู

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable tor xvfb
          pip install selenium requests

      - name: Configure and Start Tor
        run: |
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0" >> /etc/tor/torrc'
          sudo service tor start
          sleep 5

      - name: Start Bot
        # ุฃุถููุง timeout ููู ููุชูู ูุจู ุญุฏ ุงูู 6 ุณุงุนุงุช ุจู 10 ุฏูุงุฆู ููุดุบู ููุณู ูู ุฌุฏูุฏ
        run: |
          timeout 350m python bot_master1.py || echo "ุงูุชูู ุงูููุช ุงููุญุฏุฏุ ุฌุงุฑู ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุฐุงุชู..."

      - name: Self-Restart Workflow
        if: always() # ูุดุชุบู ุณูุงุก ูุฌุญ ุงูุจูุช ุฃู ูุดู ูุถูุงู ุงูุงุณุชูุฑุงุฑูุฉ
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "๐ ุฌุงุฑู ุฅุฑุณุงู ุฃูุฑ ุฅุนุงุฏุฉ ุงูุชุดุบูู ูุถูุงู ุงููุตูู ูู 12 ุณุงุนุฉ..."
          gh workflow run run_bot.yml
