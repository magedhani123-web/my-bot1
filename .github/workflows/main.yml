name: Run My Bot Forever

on:
  workflow_dispatch: # ┘Д┘Д╪к╪┤╪║┘К┘Д ╪з┘Д┘К╪п┘И┘К ╪и╪╢╪║╪╖╪й ╪▓╪▒
  schedule:
    - cron: '0 */6 * * *' # ╪к╪┤╪║┘К┘Д ╪к┘Д┘В╪з╪ж┘К ┘Г┘Д 6 ╪│╪з╪╣╪з╪к ┘Г╪з╪н╪к┘К╪з╪╖

permissions:
  actions: write # ╪╢╪▒┘И╪▒┘К ╪м╪п╪з┘Л ┘Д┘К╪к┘Е┘Г┘Ж ╪з┘Д╪│┘Г╪▒╪и╪к ┘Е┘Ж ╪е╪╣╪з╪п╪й ╪к╪┤╪║┘К┘Д ┘Ж┘Б╪│┘З

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable tor xvfb
          pip install selenium requests

      - name: Configure and Start Tor
        run: |
          sudo bash -c 'echo -e "ControlPort 9051\nCookieAuthentication 0" >> /etc/tor/torrc'
          sudo service tor start
          sleep 5

      - name: Start Bot
        # ╪г╪╢┘Б┘Ж╪з -u ┘Д╪╢┘Е╪з┘Ж ╪╕┘З┘И╪▒ ╪з┘Д╪│╪м┘Д (Log) ┘Б┘И╪▒╪з┘Л ╪│╪╖╪▒ ╪и╪│╪╖╪▒
        run: |
          timeout 350m xvfb-run python -u bot_master1.py || echo "тЪая╕П ╪з┘Ж╪к┘З┘Й ┘И┘В╪к ╪з┘Д╪м┘Д╪│╪й╪М ╪м╪з╪▒┘К ╪е╪╣╪з╪п╪й ╪з┘Д╪к╪┤╪║┘К┘Д ╪з┘Д╪к┘Д┘В╪з╪ж┘К..."

      - name: Self-Restart Workflow
        if: always() # ┘К╪┤╪к╪║┘Д ╪н╪к┘Й ┘Д┘И ╪к╪╣╪╖┘Д ╪з┘Д╪и┘И╪к ┘Д╪╢┘Е╪з┘Ж ╪з╪│╪к┘Е╪▒╪з╪▒ ╪з┘Д┘А 12 ╪│╪з╪╣╪й
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "ЁЯЪА ╪м╪з╪▒┘К ╪╖┘Д╪и ╪м┘Д╪│╪й ╪м╪п┘К╪п╪й ┘Е┘Ж GitHub Actions..."
          gh workflow run "Run My Bot Forever"
